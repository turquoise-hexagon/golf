mapfile a
for i in {0..899};{ c=;for j in {0..8}
{((e=(i/30+j/3-1)%30,f=(i+j%3-1)%30))
((${a[e<0?29:e]:f<0?29:f:1}))&&((c++));}
((${a[i/30]:i%30:1}))&&((t=1,c--))||t=0
((c-2))&&t=0;((c-3))||t=1;s[i/30]+=$t;}
printf -vo %s\\n ${s[@]};echo "$o";$0 <<< $o